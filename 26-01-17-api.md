# Groufr API v1 Documentation

**Base URL:** `/api/v1`
**Content-Type:** `application/json`
**Date:** 2026-01-17

---

## Authentication

The API supports two authentication methods:

### 1. Bearer Token (Mobile API)
```
Authorization: Bearer <access_token>
```

### 2. Session Cookie (Web Polling)
Session-based authentication for web clients using existing login session.

---

## Authentication Endpoints

### POST /api/v1/auth/login

Login with email/password to obtain access tokens.

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "secret",
  "device": {
    "uuid": "device-uuid",
    "platform": "android|ios",
    "name": "Pixel 7",
    "app_version": "1.0.0",
    "os_version": "14"
  }
}
```

**Response:**
```json
{
  "access_token": "...",
  "refresh_token": "...",
  "expires_in": 3600,
  "token_type": "Bearer",
  "user": {
    "id": 1,
    "name": "John Doe",
    "email": "user@example.com",
    "locale": "cs_CZ",
    "timezone": "Europe/Prague"
  }
}
```

---

### POST /api/v1/auth/refresh

Refresh an expired access token.

**Request Body:**
```json
{
  "refresh_token": "..."
}
```

**Response:** Same as login response.

---

### POST /api/v1/auth/logout

Logout and revoke the current access token.

**Headers:** `Authorization: Bearer <token>`

**Response:** `204 No Content`

---

### POST /api/v1/auth/logout-all

Logout from all devices (revoke all tokens).

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "revoked_count": 3
}
```

---

### POST /api/v1/auth/forgot-password

Request a password reset email.

**Request Body:**
```json
{
  "email": "user@example.com"
}
```

**Response:**
```json
{
  "success": true,
  "message": "If an account with that email exists, we've sent a password reset link."
}
```

**Rate Limiting:** 3 requests per IP per 15 minutes.

---

### POST /api/v1/auth/reset-password

Reset password using the token from email.

**Request Body:**
```json
{
  "token": "reset-token-from-email",
  "password": "new-password",
  "password_confirmation": "new-password"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Password has been reset successfully."
}
```

---

## Device Endpoints

### PUT /api/v1/device/push-token

Register or update push notification token.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "push_token": "fcm_or_apns_token",
  "provider": "fcm|apns"
}
```

**Response:**
```json
{
  "success": true
}
```

---

### DELETE /api/v1/device/push-token

Remove push notification token.

**Headers:** `Authorization: Bearer <token>`

**Response:** `204 No Content`

---

## User Profile Endpoints

### GET /api/v1/user/profile

Get current user's profile.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "id": 1,
  "name": "John Doe",
  "email": "user@example.com",
  "locale": "cs_CZ",
  "timezone": "Europe/Prague",
  "created_at": "2026-01-02T10:00:00+00:00"
}
```

---

### PUT /api/v1/user/profile

Update current user's profile.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "name": "John Doe",
  "locale": "cs_CZ",
  "timezone": "Europe/Prague"
}
```

**Response:** Updated user profile object.

---

### PUT /api/v1/user/password

Change current user's password.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "current_password": "old-password",
  "password": "new-password",
  "password_confirmation": "new-password"
}
```

**Response:**
```json
{
  "success": true
}
```

---

## Groups Endpoints

### GET /api/v1/groups

List groups the user is a member of.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "groups": [
    {
      "id": 1,
      "slug": "friends",
      "name": "Friends",
      "description": "Our friend group",
      "your_role": "member|admin|owner",
      "member_count": 10,
      "unread_count": 5,
      "created_at": "2026-01-02T10:00:00+00:00"
    }
  ]
}
```

---

### GET /api/v1/groups/{slug}

Get group details by slug.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "id": 1,
  "slug": "friends",
  "name": "Friends",
  "description": "Our friend group",
  "locale": "en",
  "your_role": "member|admin|owner",
  "owner": {
    "id": 1,
    "name": "John Doe"
  },
  "member_count": 10,
  "chat_id": 1,
  "created_at": "2026-01-02T10:00:00+00:00"
}
```

---

### GET /api/v1/groups/{groupId}/members

List members of a group.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "members": [
    {
      "user": {
        "id": 1,
        "name": "John Doe",
        "email": "john@example.com"
      },
      "role": "owner|admin|member",
      "joined_at": "2026-01-02T10:00:00+00:00"
    }
  ]
}
```

---

## Notifications Endpoints

### GET /api/v1/notifications

List notifications for the authenticated user.

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| limit | int | 50 | Max 100 |
| offset | int | 0 | Pagination offset |
| unread_only | bool | false | Filter to unread only |
| group_id | int | - | Filter by group |

**Response:**
```json
{
  "notifications": [
    {
      "id": 1,
      "event_type": "new_message|event_created|event_updated|participant_status_changed|poll_created|poll_closed|user_joined|invitation_received|event_invitation_received",
      "group_id": 1,
      "group_name": "Friends",
      "actor": {
        "id": 2,
        "name": "Jane Doe"
      },
      "entity_type": "message|event|poll|user|invitation|event_invitation",
      "entity_id": 123,
      "payload": {},
      "is_read": false,
      "created_at": "2026-01-02T10:00:00+00:00"
    }
  ],
  "meta": {
    "total": 25,
    "unread_count": 10,
    "limit": 50,
    "offset": 0
  }
}
```

**Notification Event Types:**
| Event Type | Entity Type | Description | Payload Fields |
|------------|-------------|-------------|----------------|
| `new_message` | message | New chat message (group or event) | `chat_id`, `preview`, `event_id?`, `event_title?` |
| `event_created` | event | New event created | `title`, `start_at` |
| `event_updated` | event | Event details changed | `title`, `changes` |
| `participant_status_changed` | event | Participant joined/declined | `event_title`, `participant_name`, `participant_id`, `new_status`, `changed_by_admin` |
| `poll_created` | poll | New poll created | `question`, `deadline_at` |
| `poll_closed` | poll | Poll was closed | `question` |
| `user_joined` | user | User joined group | `user_name` |
| `invitation_received` | invitation | Group invitation received | `group_name`, `group_slug`, `inviter_name`, `invitation_token` |
| `event_invitation_received` | event | Event guest invitation | `event_title`, `event_id`, `group_name`, `group_slug`, `inviter_name` |

**Note:** Event chat messages have `event_id` in payload, group chat messages do not. This distinguishes notifications for the two chat types.

---

### GET /api/v1/notifications/count

Get detailed unread notification counts (supports both Bearer token and session auth).

**Response:**
```json
{
  "unread_count": 15,
  "by_group": {
    "1": {
      "total": 8,
      "messages": 5,
      "events": 2,
      "polls": 1,
      "users": 0
    }
  },
  "by_event": {
    "5": 3
  },
  "invitations": 2,
  "timestamp": "2026-01-02T10:00:00+00:00"
}
```

---

### POST /api/v1/notifications/{id}/read

Mark a specific notification as read.

**Headers:** `Authorization: Bearer <token>`

**Response:** `204 No Content`

---

### POST /api/v1/notifications/read-all

Mark all notifications as read.

**Query Parameters:**
| Parameter | Type | Description |
|-----------|------|-------------|
| group_id | int | Only mark notifications for this group |

**Response:**
```json
{
  "marked_count": 10
}
```

---

### POST /api/v1/notifications/mark-read

Mark specific notifications as read by type.

**Request Body:**
```json
{
  "type": "group_messages|event_messages|event|poll|user_joined|invitation",
  "group_id": 1,
  "event_id": 5,
  "poll_id": 3,
  "invitation_id": 7,
  "user_id": 12
}
```

| Type | Required Fields | Description |
|------|-----------------|-------------|
| `group_messages` | `group_id` | Mark group chat messages as read |
| `event_messages` | `event_id` | Mark event chat messages as read |
| `event` | `event_id` | Mark event notifications as read |
| `poll` | `poll_id` | Mark poll notifications as read |
| `user_joined` | `user_id`, `group_id` | Mark user joined notification as read |
| `invitation` | `invitation_id` | Mark invitation notification as read |

**Response:**
```json
{
  "marked_count": 5
}
```

---

## Messages Endpoints

### GET /api/v1/groups/{groupId}/messages

Get messages from a group's global chat.

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| limit | int | 50 | Max 100 |
| before_id | int | - | Get messages before this ID (pagination) |
| after_id | int | - | Get messages after this ID (sync) |

**Response:**
```json
{
  "messages": [
    {
      "id": 1,
      "user": {
        "id": 1,
        "name": "John Doe"
      },
      "message_type": "text|system|user_joined|user_left|event_created|poll_created",
      "body": "Hello everyone!",
      "reply_to_id": null,
      "reply_to": null,
      "created_at": "2026-01-02T10:00:00+00:00",
      "edited_at": null,
      "ref_event": null,
      "ref_poll": null,
      "ref_user": null
    }
  ],
  "meta": {
    "has_more": true,
    "oldest_id": 1
  }
}
```

---

### POST /api/v1/groups/{groupId}/messages

Send a message to a group's global chat.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "body": "Hello everyone!",
  "reply_to_id": null
}
```

**Response:** `201 Created` with the created message object.

---

### GET /api/v1/events/{eventId}/messages

Get messages from an event's chat.

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| limit | int | 50 | Max 100 |
| before_id | int | - | Get messages before this ID (pagination) |
| after_id | int | - | Get messages after this ID (sync) |

**Response:** Same format as group messages.

**Access Control:** Only event participants (joined/maybe status) and guests can access event chat.

---

### POST /api/v1/events/{eventId}/messages

Send a message to an event's chat.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "body": "Looking forward to it!",
  "reply_to_id": null
}
```

**Response:** `201 Created` with the created message object.

**Access Control:** Only event participants (joined/maybe status) and guests can send messages.

---

## Polls Endpoints

### GET /api/v1/groups/{groupId}/polls

List polls in a group (group-level polls only).

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| status | string | all | Filter: `open`, `closed`, `all` |
| limit | int | 20 | Max 100 |
| offset | int | 0 | Pagination offset |

**Response:**
```json
{
  "polls": [
    {
      "id": 1,
      "group_id": 1,
      "event_id": null,
      "created_by": {
        "id": 1,
        "name": "John Doe"
      },
      "question": "Where should we go?",
      "description": "Vote for your preferred destination",
      "multiselect": false,
      "options": [
        {
          "id": 1,
          "label": "Beach",
          "vote_count": 3
        },
        {
          "id": 2,
          "label": "Mountains",
          "vote_count": 2
        }
      ],
      "your_votes": [1],
      "total_voters": 5,
      "status": "open",
      "deadline_at": "2026-01-10T23:59:59+00:00",
      "created_at": "2026-01-02T10:00:00+00:00"
    }
  ],
  "meta": {
    "total": 5,
    "limit": 20,
    "offset": 0
  }
}
```

---

### GET /api/v1/events/{eventId}/polls

List polls for a specific event.

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:** Same as group polls.

**Response:** Same format as group polls, but only returns event-specific polls.

---

### POST /api/v1/groups/{groupId}/polls

Create a new group-level poll.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "question": "Where should we go?",
  "description": "Vote for your preferred destination",
  "options": ["Beach", "Mountains", "City"],
  "multiselect": false,
  "deadline_at": "2026-01-10T23:59:59+00:00"
}
```

**Response:** `201 Created` with the created poll object.

---

### POST /api/v1/events/{eventId}/polls

Create a new event-level poll.

**Headers:** `Authorization: Bearer <token>`

**Request Body:** Same as group poll creation.

**Response:** `201 Created` with the created poll object.

---

### POST /api/v1/polls/{id}/vote

Vote on a poll.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "option_ids": [1]
}
```

**Response:** Updated poll object.

---

### DELETE /api/v1/polls/{id}/vote

Remove your vote from a poll.

**Headers:** `Authorization: Bearer <token>`

**Response:** Updated poll object.

---

## Events Endpoints

### GET /api/v1/events

List all events across all groups the user is a member of.

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| time | string | upcoming | Time filter: `upcoming`, `past`, `all` |
| participation | string | all | Participation filter: `joined`, `maybe`, `declined`, `all` - filter by user's participation status |
| state | string | - | Comma-separated states: `offered`, `preparing`, `closed`, `cancelled`. If not specified, all states are included (except `cancelled` for upcoming) |
| limit | int | 20 | Max 100 |
| offset | int | 0 | Pagination offset |

**Sorting by time filter:**
| Time Filter | Sorting | Notes |
|-------------|---------|-------|
| `upcoming` | Ascending by `start_at` | Events without `start_at` (NULL) appear at the end |
| `past` | Descending by `start_at`, then `end_at` | Events without `start_at` are excluded |
| `all` | NULL `start_at` first, then descending by `start_at`, `end_at` | Events without dates appear first |

**Example Requests:**
```
GET /api/v1/events                           # Upcoming events (excludes cancelled)
GET /api/v1/events?time=past                 # Past events
GET /api/v1/events?time=all                  # All events
GET /api/v1/events?participation=joined      # Events user has joined
GET /api/v1/events?participation=maybe       # Events user marked as maybe
GET /api/v1/events?time=upcoming&participation=joined  # Upcoming events user has joined
GET /api/v1/events?state=offered,preparing   # Only offered and preparing events
GET /api/v1/events?time=all&state=cancelled  # All cancelled events
```

**Response:**
```json
{
  "events": [
    {
      "id": 1,
      "group_id": 1,
      "group": {
        "id": 1,
        "name": "Friends",
        "slug": "friends"
      },
      "created_by": {
        "id": 1,
        "name": "John Doe"
      },
      "title": "Beach Day",
      "description": "Let's go to the beach!",
      "state": "offered",
      "start_at": "2026-01-15T10:00:00+00:00",
      "end_at": "2026-01-15T18:00:00+00:00",
      "deadline_join_at": "2026-01-14T23:59:59+00:00",
      "your_status": "joined|maybe|declined|invited|not_invited",
      "participants": {
        "joined": 5,
        "maybe": 2,
        "declined": 2,
        "invited": 3
      },
      "created_at": "2026-01-02T10:00:00+00:00"
    }
  ],
  "meta": {
    "total": 15,
    "limit": 20,
    "offset": 0,
    "filters": {
      "time": "upcoming",
      "participation": "all",
      "state": null
    }
  }
}
```

**Note:** Unlike the group-specific endpoint, this response includes a `group` object with each event to identify which group the event belongs to.

---

### GET /api/v1/groups/{groupId}/events

List events in a group.

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| filter | string | upcoming | Time filter: `upcoming`, `past`, `all` |
| participation | string | all | Participation filter: `joined`, `maybe`, `declined`, `all` - filter by user's participation status |
| limit | int | 20 | Max 100 |
| offset | int | 0 | Pagination offset |

**Sorting by filter:**
| Filter | Sorting | Notes |
|--------|---------|-------|
| `upcoming` | Ascending by `start_at` | Events without `start_at` (NULL) appear at the end |
| `past` | Descending by `start_at`, then `end_at` | Events without `start_at` are excluded |
| `all` | NULL `start_at` first, then descending by `start_at`, `end_at` | Events without dates appear first |

**Response:**
```json
{
  "events": [
    {
      "id": 1,
      "group_id": 1,
      "created_by": {
        "id": 1,
        "name": "John Doe"
      },
      "title": "Beach Day",
      "description": "Let's go to the beach!",
      "state": "offered|preparing|closed|cancelled",
      "start_at": "2026-01-15T10:00:00+00:00",
      "end_at": "2026-01-15T18:00:00+00:00",
      "deadline_join_at": "2026-01-14T23:59:59+00:00",
      "min_participants": 5,
      "max_participants": 20,
      "your_status": "joined|maybe|declined|invited|not_invited",
      "your_role": "owner|admin|participant|guest|null",
      "participants": {
        "joined": 5,
        "maybe": 2,
        "declined": 2,
        "invited": 3
      },
      "created_at": "2026-01-02T10:00:00+00:00"
    }
  ],
  "meta": {
    "total": 10,
    "limit": 20,
    "offset": 0,
    "filters": {
      "filter": "upcoming",
      "participation": "all"
    }
  }
}
```

---

### POST /api/v1/groups/{groupId}/events

Create a new event.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "title": "Beach Day",
  "description": "Let's go to the beach!",
  "start_at": "2026-01-15T10:00:00+00:00",
  "end_at": "2026-01-15T18:00:00+00:00",
  "deadline_join_at": "2026-01-14T23:59:59+00:00",
  "min_participants": 5,
  "max_participants": 20,
  "currency": "CZK"
}
```

**Response:** `201 Created` with the created event object.

---

### GET /api/v1/events/{id}

Get event details.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "id": 1,
  "group_id": 1,
  "group_name": "Friends",
  "group_slug": "friends",
  "created_by": {...},
  "title": "Beach Day",
  "description": "Let's go to the beach!",
  "state": "offered",
  "start_at": "2026-01-15T10:00:00+00:00",
  "end_at": "2026-01-15T18:00:00+00:00",
  "deadline_join_at": "2026-01-14T23:59:59+00:00",
  "min_participants": 5,
  "max_participants": 20,
  "currency": "CZK",
  "your_status": "joined",
  "your_role": "participant",
  "participants": {...},
  "participants_list": [
    {
      "user": {
        "id": 1,
        "name": "John Doe"
      },
      "status": "joined",
      "role": "owner|admin|participant|guest",
      "guest_name": null,
      "guest_email": null
    }
  ],
  "chat_id": 5,
  "created_at": "2026-01-02T10:00:00+00:00",
  "updated_at": "2026-01-02T12:00:00+00:00"
}
```

---

### PUT /api/v1/events/{id}

Update event details.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "title": "Beach Day - Updated",
  "description": "New beach location!",
  "start_at": "2026-01-15T10:00:00+00:00",
  "end_at": "2026-01-15T18:00:00+00:00",
  "deadline_join_at": "2026-01-14T23:59:59+00:00",
  "min_participants": 5,
  "max_participants": 20,
  "state": "preparing"
}
```

**Response:** Updated event object.

**Access Control:** Only event owner/admin can update.

---

### POST /api/v1/events/{id}/join

Join an event.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "success": true,
  "your_status": "joined"
}
```

---

### POST /api/v1/events/{id}/maybe

Set status as "maybe" for an event.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "success": true,
  "your_status": "maybe"
}
```

---

### POST /api/v1/events/{id}/decline

Decline an event.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "success": true,
  "your_status": "declined"
}
```

---

### GET /api/v1/events/{eventId}/participants

Get event participants.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "participants": [
    {
      "user": {
        "id": 1,
        "name": "John Doe"
      },
      "status": "joined|maybe|declined|invited",
      "role": "owner|admin|participant|guest",
      "guest_name": null,
      "guest_email": null,
      "joined_at": "2026-01-02T10:00:00+00:00"
    }
  ],
  "counts": {
    "joined": 5,
    "maybe": 2,
    "declined": 2,
    "invited": 3
  }
}
```

---

### POST /api/v1/events/{eventId}/invite-guest

Invite a guest (non-member) to an event.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "email": "guest@example.com",
  "name": "Guest Name"
}
```

**Response:**
```json
{
  "success": true,
  "invitation_id": 123
}
```

**Access Control:** Only event owner/admin can invite guests.

---

## Expenses Endpoints

### GET /api/v1/events/{eventId}/expenses

Get expenses for an event.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "expenses": [
    {
      "id": 1,
      "event_id": 5,
      "payer": {
        "id": 1,
        "name": "John Doe"
      },
      "created_by": {
        "id": 1,
        "name": "John Doe"
      },
      "label": "Gas money",
      "amount_cents": 50000,
      "currency": "CZK",
      "shares": [
        {
          "user": {
            "id": 1,
            "name": "John Doe"
          },
          "share_cents": 12500
        },
        {
          "user": {
            "id": 2,
            "name": "Jane Doe"
          },
          "share_cents": 12500
        }
      ],
      "created_at": "2026-01-02T10:00:00+00:00"
    }
  ],
  "balances": [
    {
      "user": {
        "id": 1,
        "name": "John Doe"
      },
      "balance_cents": 37500,
      "currency": "CZK"
    },
    {
      "user": {
        "id": 2,
        "name": "Jane Doe"
      },
      "balance_cents": -12500,
      "currency": "CZK"
    }
  ],
  "total_cents": 50000,
  "currency": "CZK"
}
```

---

### POST /api/v1/events/{eventId}/expenses

Create an expense.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "label": "Gas money",
  "amount_cents": 50000,
  "currency": "CZK",
  "payer_id": 1,
  "shares": [
    {"user_id": 1, "share_cents": 12500},
    {"user_id": 2, "share_cents": 12500},
    {"user_id": 3, "share_cents": 12500},
    {"user_id": 4, "share_cents": 12500}
  ]
}
```

**Response:** `201 Created` with the created expense object.

---

### PUT /api/v1/expenses/{id}

Update an expense.

**Headers:** `Authorization: Bearer <token>`

**Request Body:** Same as create.

**Response:** Updated expense object.

---

### DELETE /api/v1/expenses/{id}

Delete an expense (soft delete).

**Headers:** `Authorization: Bearer <token>`

**Response:** `204 No Content`

---

## Notification Preferences Endpoints

### GET /api/v1/user/notification-preferences

Get user's notification preferences.

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "global": {
    "new_message": {
      "email_enabled": true,
      "push_enabled": true,
      "in_app_enabled": true,
      "digest": "daily"
    },
    "event_created": {...},
    "event_updated": {...},
    "participant_status_changed": {...},
    "poll_created": {...},
    "poll_closed": {...},
    "user_joined": {...},
    "invitation_received": {...},
    "event_invitation_received": {...}
  },
  "by_group": {
    "1": {
      "new_message": {
        "email_enabled": false,
        "push_enabled": true,
        "in_app_enabled": true,
        "digest": "never"
      }
    }
  }
}
```

---

### PUT /api/v1/user/notification-preferences

Update notification preferences.

**Headers:** `Authorization: Bearer <token>`

**Request Body:**
```json
{
  "event_type": "new_message",
  "group_id": null,
  "email_enabled": true,
  "push_enabled": true,
  "in_app_enabled": true,
  "digest": "daily|weekly|none"
}
```

**Response:** Updated preferences object.

---

## Sync Endpoints

### GET /api/v1/sync

Get all updates since a timestamp (for efficient mobile sync).

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Description |
|-----------|------|-------------|
| since | ISO 8601 datetime | Get updates since this time |
| include | string | Comma-separated: `messages,polls,events,notifications` |

**Response:**
```json
{
  "sync_timestamp": "2026-01-02T10:00:00+00:00",
  "updates": {
    "groups": [
      {
        "id": 1,
        "slug": "friends",
        "name": "Friends",
        "description": "Our friend group"
      }
    ],
    "messages": {
      "created": [...],
      "deleted": [1, 2, 3]
    },
    "polls": {
      "created": [...],
      "updated": [...],
      "closed": [4, 5]
    },
    "events": {
      "created": [...],
      "updated": [...],
      "deleted": [6]
    },
    "notifications": {
      "new_count": 5
    }
  }
}
```

---

### GET /api/v1/sync/group/{groupId}

Get updates for a specific group.

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| since | ISO 8601 datetime | - | Get updates since this time |
| message_limit | int | 50 | Max 100 |

**Response:**
```json
{
  "sync_timestamp": "2026-01-02T10:00:00+00:00",
  "updates": {
    "group": {...},
    "messages": [...],
    "polls": [...],
    "events": [...],
    "notification_count": 3
  }
}
```

---

## Support Endpoint

### POST /api/v1/support

Send a support message.

**Request Body:**
```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "message": "I need help with..."
}
```

**Note:** If authenticated, `name` and `email` are optional (taken from user profile).

**Response:**
```json
{
  "success": true,
  "message": "Your message has been sent successfully."
}
```

---

## Error Responses

All errors follow this format:

```json
{
  "error": "error_code",
  "message": "Human readable message",
  "details": {}
}
```

### Common Error Codes

| HTTP Status | Error Code | Description |
|-------------|------------|-------------|
| 400 | invalid_json | Request body is not valid JSON |
| 400 | invalid_content_type | Content-Type must be application/json |
| 401 | unauthorized | Missing or invalid authentication |
| 401 | token_expired | Access token has expired |
| 403 | forbidden | Not authorized for this resource |
| 404 | not_found | Resource not found |
| 405 | method_not_allowed | HTTP method not allowed |
| 422 | validation_error | Request validation failed |
| 429 | rate_limited | Too many requests |

### Validation Error Response

```json
{
  "error": "validation_error",
  "message": "Missing required fields",
  "details": {
    "missing_fields": ["email", "password"]
  }
}
```

---

## Date/Time Format

All dates use ISO 8601 format: `YYYY-MM-DDTHH:mm:ss+HH:MM`

Example: `2026-01-02T10:00:00+00:00`

---

## Rate Limiting

| Endpoint | Limit |
|----------|-------|
| POST /auth/forgot-password | 3 requests per IP per 15 minutes |
| Other endpoints | No limit currently (may change) |

---

## Pagination

List endpoints support pagination via `limit` and `offset` parameters.

For message lists, cursor-based pagination is available via `before_id` and `after_id` parameters.

---

## Changelog from 2026-01-02

### New Notification Types
- `participant_status_changed` - Notifies when a participant joins/declines an event
- `invitation_received` - Notifies when user receives a group invitation
- `event_invitation_received` - Notifies when user is invited as guest to event

### New Entity Types
- `invitation` - Group invitation entity
- `event_invitation` - Event guest invitation entity

### New Endpoints
- `POST /auth/forgot-password` - Password reset request
- `POST /auth/reset-password` - Password reset with token
- `GET/PUT /user/profile` - User profile management
- `PUT /user/password` - Password change
- `GET /groups/{groupId}/members` - Group members list
- `GET/POST /events/{eventId}/messages` - Event chat messages
- `GET/POST /events/{eventId}/polls` - Event-level polls
- `PUT /events/{id}` - Update event
- `POST /events/{id}/maybe` - Set "maybe" status
- `GET /events/{eventId}/participants` - Event participants
- `POST /events/{eventId}/invite-guest` - Invite guest to event
- `GET/POST/PUT/DELETE /events/{eventId}/expenses` - Expense management
- `GET/PUT /user/notification-preferences` - Notification preferences
- `POST /support` - Support message

### Event Changes
- Added `min_participants` and `max_participants` fields
- Added `your_role` field (owner/admin/participant/guest)
- Added `maybe` status for participants
- Guest participant support with `guest_name` and `guest_email`

### Notification Changes
- Event chat messages are distinguished by `event_id` in payload
- Group chat messages do NOT have `event_id` in payload
- Added `by_event` counts in notification count endpoint
- Added `invitations` count in notification count endpoint

---

## Changelog from 2026-01-17

### New Endpoints
- `GET /events` - List all events across all user's groups with filtering by time (`upcoming`, `past`, `all`) and state (`offered`, `preparing`, `closed`, `cancelled`)

### Event Changes
- New cross-group events listing includes `group` object with each event containing `id`, `name`, and `slug`
- Response includes `filters` in meta to show applied filters

---

## Changelog from 2026-01-20

### Event Filtering
- Added `participation` filter to `GET /api/v1/events` endpoint - filter events by user's participation status (`joined`, `maybe`, `declined`, `all`)
- Added `participation` filter to `GET /api/v1/groups/{groupId}/events` endpoint
- Response meta now includes `filters` object showing applied filters for both endpoints

---

## Changelog from 2026-01-23

### Event Sorting Improvements
- `upcoming`: Events sorted ascending by `start_at`, with NULL values at the end
- `past`: Events sorted descending by `start_at`, then `end_at`; events without `start_at` are excluded
- `all`: Events with NULL `start_at` appear first, then sorted descending by `start_at`, `end_at`
